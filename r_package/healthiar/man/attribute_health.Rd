% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/attribute_health.R
\name{attribute_health}
\alias{attribute_health}
\title{Attribute health impacts to an environmental stressor}
\usage{
attribute_health(
  approach_risk = "relative_risk",
  erf_shape = NULL,
  rr_central = NULL,
  rr_lower = NULL,
  rr_upper = NULL,
  rr_increment = NULL,
  erf_eq_central = NULL,
  erf_eq_lower = NULL,
  erf_eq_upper = NULL,
  exp_central,
  exp_lower = NULL,
  exp_upper = NULL,
  prop_pop_exp = 1,
  pop_exp = NULL,
  cutoff_central = 0,
  cutoff_lower = NULL,
  cutoff_upper = NULL,
  bhd_central = NULL,
  bhd_lower = NULL,
  bhd_upper = NULL,
  geo_id_disaggregated = NULL,
  geo_id_aggregated = NULL,
  population = NULL,
  info = NULL,
  dw_central = NULL,
  dw_lower = NULL,
  dw_upper = NULL,
  duration_central = 1,
  duration_lower = NULL,
  duration_upper = NULL
)
}
\arguments{
\item{approach_risk}{\code{String} specifying the risk method. Options: \code{"relative_risk"} (default) or \code{"absolute_risk"}.}

\item{erf_shape}{\code{String} specifying the shape of the exposure-response function to be assumed. Options: \code{"linear"}, \code{log_linear}", \code{"linear_log"}, \code{"log_log"}.}

\item{rr_central, rr_lower, rr_upper}{\code{Numeric value(s)} specifying the central estimate of the relative risk and (optionally) the corresponding lower and upper 95\% confidence interval bounds.}

\item{rr_increment}{\code{Numeric value} specifying the concentration increment for which the provided relative risk is valid. Often 10 or 5 \eqn{µg/m^3}) (no default).}

\item{erf_eq_central, erf_eq_lower, erf_eq_upper}{\code{String} or \code{function} specifying the equation of the user-defined exposure-response function and (optionally) the corresponding lower and upper 95\% confidence interval functions.
If a \code{string} is entered, the function must contains only one variable c (concentration/exposure), e.g. \code{"3+c+c^2"}.
If a \code{function} is fed to the argument, it must be of the class \code{function}, e.g. output from \code{stats::splinefun()} or \code{stats::approxfun()} (see details).}

\item{exp_central, exp_lower, exp_upper}{\code{Numeric value(s)} specifying the exposure level(s) to the environmental stressor and (optionally) to lower and upper bound of the 95\% confidence interval. If only one value is provided, it will be assumed that it refers to population-weighted mean exposure in \eqn{µg/m^3}. If a {vector} is provided, it will be assumed that it refers to the exposure categories (average exposure in the category) in a exposure distribution (this information is linked to the proportion of population exposed).}

\item{prop_pop_exp}{\code{Numeric value} or \code{Numeric vector} specifying the fraction(s) (value from 0 until and including 1) of the total population exposed to each exposure categories. Only to be used for exposure distribution (if pop_exp not available) or if not the whole population is exposed. Otherwise, 1 will be assumed as default.}

\item{pop_exp}{\code{Numeric vector} referring to the population exposed for each exposure category. For absolute risk, the value of this argument must be entered, for relative risk only optional.}

\item{cutoff_central, cutoff_lower, cutoff_upper}{\code{Numeric value(s)} showing the central exposure cut-off in \eqn{µg/m^3} and (optionally) the corresponding lower and upper 95\% confidence interval bounds. Default: 0. Only applicable to relative risk pathways.
If exposure categories are used, the dimension of this input must be the same as in the \code{exp_...} argument(s).
The cutoff level refers to the exposure level below which no health effects occur.}

\item{bhd_central, bhd_lower, bhd_upper}{\code{Numeric value(s)} providing the baseline health data of the health outcome of interest in the study population and (optionally) the corresponding lower bound and the upper 5\% confidence interval bounds. See Details section for more info.}

\item{geo_id_disaggregated}{\code{Numeric or string vector} providing the unique ID codes of each geographic area (e.g. municipalities) considered in the assessment.}

\item{geo_id_aggregated}{\code{Numeric or string vector} providing a higher-level ID at which the geographic areas specified in \code{geo_id_disaggregated} will be aggregated. See Details section for more info.}

\item{population}{\code{Numeric value} or \code{Vector} referring to the total population, including both exposed and non-exposed (in each geographical unit). Only to be used to assess relative impact per 100k inhabitants.}

\item{info}{\code{String} or \code{data.frame} providing additional information to be linked with the assessment.
The suffix "info" will be added to the column name.
Default: \code{NULL}.}

\item{dw_central, dw_lower, dw_upper}{\code{Numeric value(s)} providing the disability weight associated with the morbidity health outcome of interest and (optionally) the corresponding lower bound and the upper 5\% confidence interval bounds.}

\item{duration_central, duration_lower, duration_upper}{\code{Numeric value(s)} providing the duration associated with the morbidity health outcome of interest in years and (optionally) the corresponding lower and upper bounds of the 95\% confidence interval. Default: 1. See Details section for more info.}
}
\value{
This function returns two \code{lists}:

1) \code{health_main}, which contains a \code{tibble} with the main results and

2) \code{health_detailed}, which contains detailed (and interim) results.

The results contain columns such as:
\itemize{
 \item \code{pop_fraction} population attributable fraction; only for assessments using relative risk
 \item \code{impact} attributable health burden/impact
 \item And many more
 }
}
\description{
This function calculates the health impacts (mortality or morbidity)
of exposure to an environmental stressor (air pollution or noise), using either relative or absolute risk.

For examples please see the vignette and/or below.
}
\details{
What you put in is what you get out

Generally, the health metric you put in (e.g. absolute disease cases, deaths per 100'000 population, DALYs, prevalence, incidence, ...) is the one you get out. Exception: if a disability weight is inputted alongside a morbidity health outcome, then the main output will be YLD.

Equations (relative risk)

The most general equation describing the population attributable fraction (PAF) mathematically is an integral form
\deqn{PAF = \frac{\int RR(x)PE(x)dx - 1}{\int RR(x)PE(x)dx}}

Where:

x     = exposure level

PE(x) = population distribution of exposure

RR(x) = relative risk at exposure level compared to the reference level

If the population exposure is described as a categorical rather than continuous exposure, the integrals in this equation may be converted to sums, resulting in the following equation for the PAF
\deqn{PAF = \frac{\sum RR_i \times PE_i dx - 1}{\sum RR_i \times PE_i dx}}

Where:

i     = is the exposure category (e.g. in bins of 1 \eqn{µg/m^3} PM2.5 or 5 dB noise exposure)

\eqn{PE_i} = fraction of population in exposure category i

\eqn{RR_i} = relative risk for exposure category level i compared to the reference level

There is one alternative for the PAF for categorical exposure distribution that is commonly used. It is mathematically equivalent to the equation right above, meaning that numerical estimates based on these equations are identical.
\deqn{PAF = \frac{\sum PE_i(RR_i - 1)}{\sum PE_i(RR_i - 1) + 1}}

Where:

i     = is the exposure category (e.g. in bins of 1 \eqn{µg/m^3} PM2.5 or 5 dB noise exposure)

\eqn{PE_i} = fraction of population in exposure category i

\eqn{RR_i} = relative risk for exposure category level i compared to the reference level

Finally, if the exposure is provided as the population weighted mean concentration (PWC), the equation for the PAF is reduced to
\deqn{PAF = \frac{RR_{PWC} - 1}{RR_{PWC}}}
Where \eqn{RR_PWC} is the relative risk associated with the population weighted mean exposure.

Equation (absolute risk)
\deqn{N = \sum AR_i\times PE_i}

Where:

N = the number of cases of the exposure-specific health outcome that are attributed to the exposure

\eqn{AR_i} = absolute risk at the mean of exposure bin i

\eqn{PE_i} = fraction of the population exposed to exposure levels of the exposure category i

Conversion of alternative risk measures to relative risks

For conversion of hazard ratios and/or odds ratios to relative risks refer to https://doi.org/10.1111/biom.13197 and/or use the conversion tool for hazard ratios (https://ebm-helper.cn/en/Conv/HR_RR.html) and/or odds ratios (https://ebm-helper.cn/en/Conv/OR_RR.html).

Function arguments

\code{erf_eq_...}

If you have x-axis (exposure) and y axis (relative risk) value pairs of multiple points lying on the the exposure-response function, you could use a cubic spline natural interpolation to derive the exposure-response function using, e.g. \code{stats::splinefun(x, y, method="natural")}.

\code{bhd_...}

text

\code{duration_...}

The default of \code{duratoin_central} is 1 year, which is aligned with the prevalence-based approach , while a value above 1 year corresponds to the incidence-based approach (Kim, 2022, https://doi.org/10.3961/jpmph.21.597).

\code{geo_id_aggregated}

For example, if you provide the municipality names to \code{geo_id_disaggregated}, you might provide to \code{geo_id_aggregated} the corresponding region / canton / province.
Consequently, the vectors fed to \code{geo_id_disaggregated} and \code{geo_id_aggregated} must be of the same length..
}
\examples{
# Goal: attribute lung cancer cases to population-weighted PM2.5 exposure
# using relative risk

results <- attribute_health(
  erf_shape = "log_linear",
  rr_central = 1.369,            # Central relative risk estimate
  rr_increment = 10,             # per μg / m^3 increase in PM2.5 exposure
  exp_central = 8.85,            # Central exposure estimate in μg / m^3
  cutoff_central = 5,            # μg / m^3
  bhd_central = 30747            # Baseline health data: lung cancer incidence
 )

print(results$health_main$impact_rounded) # Attributable cases
# Goal: attribute cases of high annoyance to (road traffic) noise exposure

results <- attribute_health(
  approach_risk = "absolute_risk",
  exp_central = c(57.5, 62.5, 67.5, 72.5, 77.5),
  pop_exp = c(387500, 286000, 191800, 72200, 7700),
  erf_eq_central = "78.9270-3.1162*c+0.0342*c^2"
)

print(results$health_main$impact_rounded) # Attributable cases
# Goal: attribute disease cases to PM2.5 exposure in multiple geographic
# units, such as municipalities, provinces, countries, …
results <- attribute_health(
  geo_id_disaggregated = c("Zurich", "Basel", "Geneva", "Ticino", "Valais"),
  geo_id_aggregated = c("Ger","Ger","Fra","Ita","Fra"),
  rr_central = 1.369,
  rr_increment = 10,
  cutoff_central = 5,
  erf_shape = "log_linear",
  exp_central = c(11, 11, 10, 8, 7),
  bhd_central = c(4000, 2500, 3000, 1500, 500)
)

# Attributable cases (aggregated)
results$health_main$impact_rounded

# Attributable cases (disaggregated)
results$health_detailed$impact_raw |> select(
  geo_id_disaggregated,
  geo_id_aggregated,
  impact_rounded
)
}
\author{
Alberto Castro & Axel Luyten
}
