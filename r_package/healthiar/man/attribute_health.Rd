% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/attribute_health.R
\name{attribute_health}
\alias{attribute_health}
\title{Attribute health impacts to an environmental stressor}
\usage{
attribute_health(
  # RR & AR
  approach_risk = "relative_risk", # alternative: "absolute_risk"
  exp_central, exp_lower = NULL, exp_upper = NULL,
  cutoff_central = 0, cutoff_lower = NULL, cutoff_upper = NULL,
  pop_exp = NULL,
  prop_pop_exp = 1,
  erf_eq_central = NULL, erf_eq_lower = NULL, erf_eq_upper = NULL,
  # RR ONLY
  rr_central = NULL, rr_lower = NULL, rr_upper = NULL,
  rr_increment = NULL,
  erf_shape = NULL,
  bhd_central = NULL, bhd_lower = NULL, bhd_upper = NULL,
  # ITERATION (OPTIONAL)
  geo_id_disaggregated = "a",
  geo_id_aggregated = NULL,
  # META (OPTIONAL)
  info = NULL,
  population = NULL,
  # YLD (OPTIONAL)
  dw_central = NULL, dw_lower = NULL, dw_upper = NULL,
  duration_central = 1, duration_lower = NULL, duration_upper = NULL
)
}
\arguments{
\item{approach_risk}{\code{String value} specifying the risk method. Options: \code{"relative_risk"} (default) or \code{"absolute_risk"}.}

\item{exp_central, exp_lower, exp_upper}{\code{Numeric value} or \code{numeric vector} specifying the exposure level(s) to the environmental stressor and (optionally) the corresponding lower and upper bound of the 95\% confidence interval. See Details for more info.}

\item{cutoff_central, cutoff_lower, cutoff_upper}{\code{Numeric value} specifying the exposure cut-off value and (optionally) the corresponding lower and upper 95\% confidence interval bounds. Default: 0. See Details for more info.}

\item{pop_exp}{\code{Numeric vector} referring to the population exposed to each exposure category. \emph{Required in AR pathways; optional in RR pathways.}}

\item{prop_pop_exp}{\code{Numeric value} or \code{numeric vector} specifying the fraction(s) of the total population exposed to the exposure (categories). Default: 1. See Details for more info. \emph{Optional in AR pathways.}}

\item{erf_eq_central, erf_eq_lower, erf_eq_upper}{\code{String} or \code{function} specifying the exposure-response function and (optionally) the corresponding lower and upper 95\% confidence interval functions. See Details for more info. \emph{Required in AR pathways; in RR pathways required only if \code{rr_...} argument(s) not specified.}}

\item{rr_central, rr_lower, rr_upper}{\code{Numeric value} specifying the central estimate of the relative risk and (optionally) the corresponding lower and upper 95\% confidence interval bounds. \emph{Only applicable in RR pathways; not required if \code{erf_eq_...} argument(s) already specified.}}

\item{rr_increment}{\code{Numeric value} specifying the concentration increment for which the provided relative risk is valid. See Details for more info. \emph{Only applicable in RR pathways; not required if \code{erf_eq_...} argument(s) already specified.}}

\item{erf_shape}{\code{String value} specifying the shape of the exposure-response function to be assumed. Options (no default): \code{"linear"}, \code{log_linear}", \code{"linear_log"}, \code{"log_log"}. \emph{Only applicable in RR pathways; not required if \code{erf_eq_...} argument(s) already specified.}}

\item{bhd_central, bhd_lower, bhd_upper}{\code{Numeric value} or \code{numeric vector} providing the baseline health data of the health outcome of interest in the study population and (optionally) the corresponding lower bound and the upper 95\% confidence interval bounds. See Details for more info. \emph{Only applicable in RR pathways; always required.}}

\item{geo_id_disaggregated, geo_id_aggregated}{\code{Numeric vector} or \code{string vector} providing unique IDs of each geographic area considered in the assessment (\code{geo_id_disaggregated}) and (optionally) providing higher-level IDs to aggregate the geographic areas (\code{geo_id_disaggregated}). See Details for more info. \emph{Only applicable in assessments with multiple geographic units.}}

\item{dw_central, dw_lower, dw_upper}{\code{Numeric value} or \code{numeric vector} providing the disability weight associated with the morbidity health outcome of interest and (optionally) the corresponding lower bound and the upper 95\% confidence interval bounds. \emph{Only applicable in assessments of YLD (years lived with disability).}}

\item{duration_central, duration_lower, duration_upper}{\code{Numeric value} or \code{numeric vector} providing the duration associated with the morbidity health outcome of interest in years and (optionally) the corresponding lower and upper bounds of the 95\% confidence interval. Default: 1. See Details for more info. \emph{Only applicable in assessments of YLD (years lived with disability).}}

\item{info}{\code{String}, \code{data frame} or \code{tibble} specifying information to be linked with the assessment. See Details for more info. \emph{Optional argument.}}

\item{population}{\code{Numeric value} or \code{numeric vector} specifying the total population (exposed + non-exposed), to calculate attributable impacts per 100 000 population. See Details for more info. \emph{Optional argument.}}
}
\value{
This function returns two \code{lists}:

1) \code{health_main}, which contains a \code{tibble} with the main results and

2) \code{health_detailed}, which contains detailed (and interim) results.

The results contain columns such as:
\itemize{
 \item \code{pop_fraction} population attributable fraction; only applicable in relative risk assessments
 \item \code{impact} attributable health burden/impact
 \item And many more
 }
}
\description{
This function calculates the attributable health impacts (mortality or morbidity) due to
exposure to an environmental stressor (air pollution or noise), using either relative risk (\strong{RR}) or absolute risk (\strong{AR}).

For (short) \strong{examples} please see below or consult the vignette for more detailed examples.
}
\details{
\strong{Iteration}

To iterate an assessment across multiple geographic units with \code{attribute_health()}, you must enter vectors of unit-specific

- unique geo IDs to \code{geo_id_disaggregated} (\emph{both RR and AR pathways}), and optionally \code{geo_id_aggregated} (\emph{both RR and AR pathways});

- exposure values to \code{exp_...} (\emph{both RR and AR pathways});

- baseline health data values to \code{bhd_...} (\emph{RR pathway only})

- (in case of multiple exposure categories) values specifying the population exposed per exposure category to \code{pop_exp} (\emph{both RR and AR pathways})

- (in case of mutliple exposure categories) values specifying the proportion of the total exposed population that is exposed to each exposure category to \code{prop_pop_exp} (\emph{both RR and AR pathways; in AR pathway in combination with \code{pop_exp}})

- population values specifying total population (exposed + non-exposed)

The length of each of these vectors listed above must be: length = (number of geo units) x (number of exposure categories).

To the other function arguments not listed above you can feed either a vector of the same length or a single value (will be recycled).

The health metric you put in (e.g. absolute disease cases, deaths per 100 000 population, DALYs, prevalence, incidence, ...) is the one you get out. Exception: if you enter a disability weight the attributable impact will be in YLD (years lived with disability).

\strong{Function arguments}

\code{exp_central}, \code{exp_lower}, \code{exp_upper}

In case of exposure bands enter only one exposure value per band (e.g. the means of the lower and upper bounds of the exposure bands).

\code{cutoff_central}, \code{cutoff_lower}, \code{cutoff_upper}

The cutoff level refers to the exposure level below which no health effects occur in the same unit as the exposure. If exposure categories are used, the length of this input must be the same as in the \code{exp_...} argument(s).

\code{prop_pop_exp}

\emph{Optional in AR pathways.} In RR pathways indicates the share(s) (value(s) from 0 until and including 1) of the total population which is exposed to the exposure (categories). In AR pathways it is optional and only to be used combination with \code{pop_exp}: the sum of \code{pop_exp} will be used as the reference population to which the shares specified in \code{prop_pop_exp} apply.

\code{erf_eq_central}, \code{erf_eq_lower}, \code{erf_eq_upper}

\emph{Required in AR pathways; in RR pathways required only if rr_... arguments not specified.} Enter the exposure-response function as a \code{function}, e.g. output from \code{stats::splinefun()} or \code{stats::approxfun()}, or as a \code{string} formula, e.g. \code{"3+c+c^2"} (with the \emph{c} representing the concentration/exposure).

If you have x-axis (exposure) and y-axis (relative risk) value pairs of multiple points lying on the the exposure-response function, you could use e.g. \code{stats::splinefun(x, y, method="natural")} to derive the exposure-response function (in this example using a cubic spline natural interpolation).

\code{rr_increment}

\emph{Only applicable in RR pathways.} Relative risks from the literature are valid for a specific increment in the exposure, in case of air pollution often 10 or 5 \eqn{µg/m^3}).

\code{bhd_central}, \code{bhd_lower}, \code{bhd_upper}

\emph{Only applicable in RR pathways.} Baseline health data for each exposure category must be entered.

\code{geo_id_aggregated}, \code{geo_id_disaggregated}

\emph{Only applicable in assessments with multiple geographic units.} For example, if you provide the names of the municipalities under analysis to \code{geo_id_disaggregated}, you might provide to \code{geo_id_aggregated} the corresponding region / canton / province names.
Consequently, the vectors fed to \code{geo_id_disaggregated} and \code{geo_id_aggregated} must be of the same length.

\code{info}

\emph{Optional argument.} Information entered to this argument will be added as column(s) (with the suffix \code{_info}) to the results table.

\code{population}

\emph{Optional argument.} The total population entered here is used to determine impact rate per 100 000 population.

\code{duration_central}, \code{duration_lower}, \code{duration_upper}

\emph{Only applicable in assessments of YLD (years lived with disability).} The default of \code{duration_central} is 1 year, which is aligned with the prevalence-based approach , while a value above 1 year corresponds to the incidence-based approach (Kim, 2022, https://doi.org/10.3961/jpmph.21.597).

\strong{Equations (relative risk)}

The most general equation describing the population attributable fraction (PAF) mathematically is an integral form
\deqn{PAF = \frac{\int RR(x)PE(x)dx - 1}{\int RR(x)PE(x)dx}}

Where:

x     = exposure level

PE(x) = population distribution of exposure

RR(x) = relative risk at exposure level compared to the reference level

If the population exposure is described as a categorical rather than continuous exposure, the integrals in this equation may be converted to sums, resulting in the following equation for the PAF
\deqn{PAF = \frac{\sum RR_i \times PE_i dx - 1}{\sum RR_i \times PE_i dx}}

Where:

i     = is the exposure category (e.g. in bins of 1 \eqn{µg/m^3} PM2.5 or 5 dB noise exposure)

\eqn{PE_i} = fraction of population in exposure category i

\eqn{RR_i} = relative risk for exposure category level i compared to the reference level

There is one alternative for the PAF for categorical exposure distribution that is commonly used. It is mathematically equivalent to the equation right above, meaning that numerical estimates based on these equations are identical.
\deqn{PAF = \frac{\sum PE_i(RR_i - 1)}{\sum PE_i(RR_i - 1) + 1}}

Where:

i     = is the exposure category (e.g. in bins of 1 \eqn{µg/m^3} PM2.5 or 5 dB noise exposure)

\eqn{PE_i} = fraction of population in exposure category i

\eqn{RR_i} = relative risk for exposure category level i compared to the reference level

Finally, if the exposure is provided as the population weighted mean concentration (PWC), the equation for the PAF is reduced to
\deqn{PAF = \frac{RR_{PWC} - 1}{RR_{PWC}}}
Where \eqn{RR_PWC} is the relative risk associated with the population weighted mean exposure.

\strong{Equation (absolute risk)}
\deqn{N = \sum AR_i\times PE_i}

Where:

N = the number of cases of the exposure-specific health outcome that are attributed to the exposure

\eqn{AR_i} = absolute risk at the mean of exposure bin i

\eqn{PE_i} = fraction of the population exposed to exposure levels of the exposure category i

\strong{Conversion of alternative risk measures to relative risks}
For conversion of hazard ratios and/or odds ratios to relative risks refer to https://doi.org/10.1111/biom.13197 and/or use the conversion tool for hazard ratios (https://ebm-helper.cn/en/Conv/HR_RR.html) and/or odds ratios (https://ebm-helper.cn/en/Conv/OR_RR.html).
}
\examples{
# Goal: attribute lung cancer cases to population-weighted PM2.5 exposure
# using relative risk

results <- attribute_health(
  erf_shape = "log_linear",
  rr_central = 1.369,            # Central relative risk estimate
  rr_increment = 10,             # per μg / m^3 increase in PM2.5 exposure
  exp_central = 8.85,            # Central exposure estimate in μg / m^3
  cutoff_central = 5,            # μg / m^3
  bhd_central = 30747            # Baseline health data: lung cancer incidence
 )

print(results$health_main$impact_rounded) # Attributable cases
# Goal: attribute cases of high annoyance to (road traffic) noise exposure using absolute risk

results <- attribute_health(
  approach_risk = "absolute_risk",
  exp_central = c(57.5, 62.5, 67.5, 72.5, 77.5),
  pop_exp = c(387500, 286000, 191800, 72200, 7700),
  erf_eq_central = "78.9270-3.1162*c+0.0342*c^2"
)

print(results$health_main$impact_rounded) # Attributable cases
# Goal: attribute disease cases to PM2.5 exposure in multiple geographic
# units, such as municipalities, provinces, countries, …
results <- attribute_health(
  geo_id_disaggregated = c("Zurich", "Basel", "Geneva", "Ticino"),
  geo_id_aggregated = c("Ger","Ger","Fra","Ita"),
  rr_central = 1.369,
  rr_increment = 10,
  cutoff_central = 5,
  erf_shape = "log_linear",
  exp_central = c(11, 11, 10, 8),
  bhd_central = c(4000, 2500, 3000, 1500)
)

# Attributable cases (aggregated)
results$health_main$impact_rounded

# Attributable cases (disaggregated)
results$health_detailed$impact_raw |> dplyr::select(
  geo_id_disaggregated,
  geo_id_aggregated,
  impact_rounded
)
}
\author{
Alberto Castro & Axel Luyten
}
