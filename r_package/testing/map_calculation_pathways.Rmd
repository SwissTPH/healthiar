---
title: "map_calculation_pathtways"
author: "Axel Luyten"
output: html_document
---

To limit the number of possible pathways there is one pathway per major calculation group:
- rr & ar
- lifetable
- social analysis
- monetization

```{r Example}
library(DiagrammeR) ; library(data.tree)
knitr::opts_knit$set(root.dir = getwd()) 

steps <- list(
  ERF_shape = c("linear", "log-linear"),
  cutoff = c(0, 5),
  exposure_metric = c("mean", "median", "P95"),
  population_subgroup = c("all", "adults", "children")
)

## Get all possible combinations: each row is a unique pathway
pathways <- expand.grid(steps)

pathways <- pathways |> 
  dplyr::mutate(pathway_id = seq_len(nrow(pathways)))

DiagrammeR::grViz("
  digraph pathways {
    rankdir=LR;
    node [shape = rectangle];
    A [label = 'ERF Shape'];
    B [label = 'Cutoff'];
    C [label = 'Exposure Metric'];
    D [label = 'Population Subgroup'];

    A -> B -> C -> D;
  }
")

## Build tree with {data.tree}
create_tree <- function(steps, current_node) {
  step_name <- names(steps)[1]  # Get the current step name
  options <- steps[[1]]        # Get the options for the current step
  remaining_steps <- steps[-1] # Remove the current step from the list
  
  for (option in options) {
    child <- current_node$AddChild(option)  # Add child node for each option
    if (length(remaining_steps) > 0) {
      create_tree(remaining_steps, child)  # Recursive call for remaining steps
    }
  }
}
root <- Node$new("Start")
create_tree(steps, root)
print(root, "level")
plot(root)
```


```{r Pathways non-lifetable}
ov_rr_ar <- list(
  # erf = c("lin-lin", "log-lin", "lin-log", "log-log", "formula", "point-pairs"),
  erf = c("log-lin", "lin-lin", "formula", "point-pairs"),
  exp = c("pop-weighted", "exp_dist"), # prop_pop_exp linked with this
  cutoff = c("NULL", "num"),
  iteration = c("TRUE", "FALSE"),
  multiexp = c("NULL", "additive", "multiplicative", "combined"),
  variable_uncertainty = c("TRUE", "FALSE")
)

pathways_rr_ar <- expand.grid(ov_rr_ar)
```


```{r Pathways lifetable}

ov_lifetable <- list(
  exp = c("pop-weighted", "exp_dist"), # prop_pop_exp linked with this
  exp_time = c("single_year", "constant"),
  newborns = c("with", "without"),
  min_age = c("NULL", "num"),
  max_age = c("NULL", "num"),
  time_horizon = c("NULL", "num"),
  iteration = c("TRUE", "FALSE"),
  variable_uncertainty = c("TRUE", "FALSE")
)

pathways_lifetable <- expand.grid(ov_lifetable)
```

```{r Pathways summary uncertainty}

ov_uncertainty <- list(
  exp = c("pop-weighted", "exp_dist"),
  erf = c("rr_increment", "rr_formula", "rr_point_pairs", "ar_formula", "ar_point_pairs"),
  iteration = c("TRUE", "FALSE")
)

pathways_uncertainty <- expand.grid(ov_uncertainty)
```

```{r Pathways cba,discount,monetization}

ov_economic <- list(
  discount_appr = c("direct", "indirect"),
  discount_rate = c("NULL", "num"),
  discount_shape = c("exp", "hyp_harvey", "hyp_mazur"),
  discount_overtime = c("all_years", "last_year")
)

pathways_economic <- expand.grid(ov_economic)
```

